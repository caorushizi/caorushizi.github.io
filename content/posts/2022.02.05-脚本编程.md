---
title: "2022.02.05 脚本编程"
date: 2022-02-05T17:51:41+08:00
---

# shell 基础
## 自定义变量


变量名遵循原则

- 变量是任何字母、数字和下划线组成的字符串，且不能以数字开头
- 区分字母大小写，例如 Var1 和 var1 是不同的
- 变量、等号、值中间不能出现任何空格

​

变量引用

- var1=10 等号前后不能有空格
- echo $var1
```shell
#!/bin/bash

var1=abc

echo $var1
```
## 位置变量
当一个命令或者脚本执行的是哦户，后面可以跟多个参数，我们使用位置参数变量来表示这些参数

| 位置参数变量 | 含义 |
| --- | --- |
| $n | n为数字，$0 代表脚本本身，$1~$9代表1-9个参数，10以上的参数需要大括号包含，如${10} |
| $@ | 命令行所有参数，但是每个参数区别对待 |
| $* | 命令行所有参数，所有参数视为一个整体 |
| $# | 参数的个数 |

## 环境变量
简介

- linux是一个多租户的操作系统，针对不同的用户都会有一个转悠的运行环境
- 不同用户的专有环境就是一组默认环境变量的组合

​

环境变量的分类

- 对所有用户生效的环境变量		/ect/profile
- 对特定用户的生效的环境变量	~/.bashrc 或者 ~/.bash_profile
- 练市有效的环境变量			脚本或者命令行使用export

​

常用的环境变量

| 环境变量 | 含义 |
| --- | --- |
| PATH | 命令搜索的路径 |
| HOME | 用户的家目录的路径 |
| LOGNAME | 用户登录名 |
| PWD | 当前所在的路径 |
| HISTFILE | 历史命令的保存文件 |
| HISTSIZE | 历史命令保存的最大行数 |
| HOSTNAME | 主机名 |
| SHELL | 用户当前使用的SHELL |
| PS1 | 以及命令提示符 |
| TMOUT | 用户和系统交互过程的超时值 |
| IFS | 系统输入的分隔符 |
| OFS | 系统输出的分隔符 |

环境变量一般都是大写
​

## 管道

- 将系统上所有的软件包列出来，然后去搜索Python相关的软件包
- 解决方法：使用命令列出系统已有的所有软件包，然后把结果重定向到文件中，然后在文件中搜索python
- rpm -qa > all_soft.txt 在利用vim去搜索python

​

使用管道解决问题

- 列出所有的软件包，然后将结果传递给后续命令处理
- rpm -qa | grep python | wc -l

​

管道定义

- 将一个命令的输出作为另一个命令的输入
- 从某种意义上来说，是重定向的简易实现

​

## 退出状态码

- 所有的shell命令都使用退出状态码来告知shell它已经执行完毕
- 退出状态码是一个0~255的整数值
- Linux 提供了一个$?来捕获退出状态码的值

​

![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1635811649170-e96ce702-61a6-44b1-acf5-b8de0043756f.png#clientId=uefd433ca-88c6-4&from=paste&height=593&id=ub01d7a09&margin=%5Bobject%20Object%5D&name=image.png&originHeight=593&originWidth=1192&originalType=binary&ratio=1&size=278305&status=done&style=none&taskId=u192b5893-7367-4ef5-85be-77e7dd23d71&width=1192)


实践用法

| 状态码 | 含义 |
| --- | --- |
| 0 | 命令执行成功的情况 |
| 非0 | 不成功的情况 |

## 改变退出状态码exit命令

- 退出状态码是以上一条指令的返回结果为准
- exit $exit_code
- exit 48 或者 exit 125 或者 exit 0

​

## 单引号和双引号有哪些坑

- 处理变量时，单引号和双引号的区别
- 处理字符串变量时，单引号和双引号的区别
- 单引号套用是需要注意那些区别
- sed 和 awk 中需要注意单双引号的那些差异

​

# 判断和控制
## 使用 if-then 语句
```shell
if command | condition
then
	commands
fi
```
```shell
if command | condition
then
	commands
else
	commands
fi
```
## 嵌套if
```shell
if command | condition
then
	commands
elif command | condition
	commands
else
	commands
fi
```
## 条件测试 - 数值比较
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1635814827762-b0a239a4-b29b-4105-b8e5-1531e6d18719.png#clientId=uefd433ca-88c6-4&from=paste&height=432&id=u44f401de&margin=%5Bobject%20Object%5D&name=image.png&originHeight=432&originWidth=1076&originalType=binary&ratio=1&size=348156&status=done&style=none&taskId=u1bba36be-bdcd-4c19-a11a-573d8760bc8&width=1076)

- 需要使用方括号包裹条件
- command 返回0， 执行 if 中的语句
- condition true 执行 if 中的语句

![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636594292550-fbfa0023-31d9-4aed-97ef-7a28086eb47f.png#clientId=ua0e52347-1665-4&from=paste&height=234&id=ubc99e87a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=248&originWidth=264&originalType=binary&ratio=1&size=33328&status=done&style=none&taskId=u6559f93d-3440-4c15-b197-0082caad432&width=249)


## 字符串比较
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636594534584-bd19a077-ef63-490f-9ede-23f4b9ac63b3.png#clientId=ua0e52347-1665-4&from=paste&height=110&id=u97169a24&margin=%5Bobject%20Object%5D&name=image.png&originHeight=220&originWidth=510&originalType=binary&ratio=1&size=49312&status=done&style=none&taskId=u5ea8f0b9-6446-4f11-bd36-6b650f1dd7b&width=255)


## 文件比较
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636594845514-6b039814-e9fc-4c50-9016-fd0314a6efe6.png#clientId=ua0e52347-1665-4&from=paste&height=126&id=uf0a03687&margin=%5Bobject%20Object%5D&name=image.png&originHeight=251&originWidth=553&originalType=binary&ratio=1&size=39817&status=done&style=none&taskId=u6f72dee3-28fe-49ec-9f86-4825884f35d&width=276.5)
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636594914323-b4cd94ba-2e34-4005-8693-8bd867ccb376.png#clientId=ua0e52347-1665-4&from=paste&height=128&id=u47c0e869&margin=%5Bobject%20Object%5D&name=image.png&originHeight=108&originWidth=369&originalType=binary&ratio=1&size=20692&status=done&style=none&taskId=u3ac328d7-b990-4457-b15f-e4293e1ff67&width=437.5)
## 复合条件
```shell
var1=56
var2=23
var3=89

if [ $var1 -gt $var2 ] && [ $var3 -lt $var3 ];then
	echo "$var1 < $var2 并且 $var2 > $var3"
fi
```
## if-then 中使用双括号

- 使用双括号进行算数运算



```shell
if (( expression )); then
	command
fi
```
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636595373477-a1e13b51-b2eb-4fc0-930d-0c4b0502fbb4.png#clientId=ua0e52347-1665-4&from=paste&height=142&id=uf2fb3a60&margin=%5Bobject%20Object%5D&name=image.png&originHeight=284&originWidth=582&originalType=binary&ratio=1&size=35475&status=done&style=none&taskId=ub4b42162-4af4-4eeb-be59-1813ce7c1f0&width=291)
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636595385347-6879c9a2-d1d7-4b5d-8453-ed691d937b0f.png#clientId=ua0e52347-1665-4&from=paste&height=104&id=uae12699c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=207&originWidth=525&originalType=binary&ratio=1&size=24622&status=done&style=none&taskId=uc732e248-f48e-4754-aa1b-eff9bf4277c&width=262.5)


- 双括结构中，变量名引用可以加$，也可以不加
- 运算符前后可以有空格，也可以没有
- 可以用于if、for、while等循环控制结构中
- 多个运算符使用逗号分割

​

## 双方括号

- 双括号结构中，变量名引用必须加$
- 双方括号]]前面必须有空格，[[后面也必须有空格

​

# case 命令
```shell
case $var in
	pattern1)
  	commands
    ;;
  pattern2)
  	commands
    ;;
  *)
  	commands
    ;;
esac
```


# for 命令
```shell
for vat in list
do
	commands
done
```
## for 读取列表值
```shell
for i in Beijing Shanghai Nanjing
do
	echo ''
done

for i in {1..20}
do
	echo "number is $i"
done
```


## for 循环读取变量的值
```shell
IFS=":"

list="Zhangsan Lisi Mike"
for i in $list
do
	echo "number is $i"
done
```


## for 循环从命令执行结果读取值
```shell
# 命令替换
for i in $(ls /opt)
do
	echo 'all list'
done
```
## 
## c语言风格的for循环


```shell
for (( i=10; i < 50; i++ ))
do
	echo 'current'
done
```


## while 循环命令
```shell
while command
do
	commands
done
```


## until 命令
```shell
until command
do
	echo "number is $1"
done
```


## 控制循环的break指令
break n
退出深层的循环
​

## 处理for循环的输出
可以使用重定向和管道输出来对for循环的结果进行处理。


# 变量的高级用法
## 变量的替换
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636604943913-d22a2323-edd8-4928-bd1b-d194a8e2d64b.png#clientId=ua0e52347-1665-4&from=paste&height=202&id=ua323790e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=403&originWidth=971&originalType=binary&ratio=1&size=376584&status=done&style=none&taskId=ub2a51e8b-7cec-473c-9b3c-df4d3c5a19d&width=485.5)


![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636605215983-59ebe898-20ef-4627-8608-f21d333ea027.png#clientId=ua0e52347-1665-4&from=paste&height=110&id=u916b08b9&margin=%5Bobject%20Object%5D&name=image.png&originHeight=220&originWidth=554&originalType=binary&ratio=1&size=55725&status=done&style=none&taskId=uc58aa426-aa76-49c1-ab14-8654b99a42a&width=277)


## 变量的测试
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636605252542-97a314cc-0488-4b85-90c0-e6f442ddc588.png#clientId=ua0e52347-1665-4&from=paste&height=160&id=ua5ebd9f0&margin=%5Bobject%20Object%5D&name=image.png&originHeight=320&originWidth=915&originalType=binary&ratio=1&size=211331&status=done&style=none&taskId=uc9f850c6-ca5d-4e7a-8134-f838899c73c&width=457.5)


## 字符串处理
计算字符串长度
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636605375507-3d7b36d0-bd9f-4da7-b3d8-760245e3aa9c.png#clientId=ua0e52347-1665-4&from=paste&height=82&id=u26b75982&margin=%5Bobject%20Object%5D&name=image.png&originHeight=163&originWidth=978&originalType=binary&ratio=1&size=60405&status=done&style=none&taskId=ube2c4ed6-1973-480b-a551-7c22ab52c4b&width=489)


获取子串在字符串中的索引位置
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636605410116-31438683-5eaa-4107-8881-f9cf6fb6288f.png#clientId=ua0e52347-1665-4&from=paste&height=30&id=u93829919&margin=%5Bobject%20Object%5D&name=image.png&originHeight=60&originWidth=696&originalType=binary&ratio=1&size=24820&status=done&style=none&taskId=ub14a5257-2008-46ae-9606-92645df073a&width=348)


获取子串的长度
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636605435777-77b56847-8e1a-4094-a955-bc9020f96700.png#clientId=ua0e52347-1665-4&from=paste&height=28&id=u676a9fb5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=55&originWidth=697&originalType=binary&ratio=1&size=20540&status=done&style=none&taskId=u1b16c697-3fbf-457d-8f50-6c92ba3b195&width=348.5)


抽取子串
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636605460491-6604ee58-a520-4486-bb2e-4419e45a9cdc.png#clientId=ua0e52347-1665-4&from=paste&height=136&id=ub6e59724&margin=%5Bobject%20Object%5D&name=image.png&originHeight=272&originWidth=952&originalType=binary&ratio=1&size=174900&status=done&style=none&taskId=ue06a172b-aa32-48ea-90f6-092ce06b5e0&width=476)


## 字符串处理完整的脚本
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636606550306-6581f418-6971-41db-bbdb-e3e12bdb9144.png#clientId=ua0e52347-1665-4&from=paste&height=125&id=u11a985e8&margin=%5Bobject%20Object%5D&name=image.png&originHeight=250&originWidth=923&originalType=binary&ratio=1&size=136778&status=done&style=none&taskId=ub7456ad1-feb8-4bbf-8e42-d2e11a025de&width=461.5)


## 命令替换

- ``command``
- `$(command)`

​

## 有类型的变量

- declare命令和typeset命令两者等价
- declare、typeset命令都是用来定义变量类型的

![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636683662389-7df8d941-821f-4344-8bb0-c16cf93b77d3.png#clientId=ue8d82e11-d7d8-4&from=paste&height=174&id=u88bb4b48&margin=%5Bobject%20Object%5D&name=image.png&originHeight=348&originWidth=919&originalType=binary&ratio=1&size=128456&status=done&style=none&taskId=ua1b52dbb-3a2b-4ff1-a266-7992aaaf80a&width=459.5)


`declare -a ("a" "b")`


- `+a`取消
- `-a`设置
## bash 数学运算 expr

- `expr $num1 operator $num2`
- `$(($num1 operator $num2))`

![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636691112006-31ff8fd0-3ca4-4021-980d-7f5c0459585b.png#clientId=ue8d82e11-d7d8-4&from=paste&height=179&id=u201b2ab9&margin=%5Bobject%20Object%5D&name=image.png&originHeight=357&originWidth=829&originalType=binary&ratio=1&size=217109&status=done&style=none&taskId=ucca2d506-10da-4270-aa83-6d56f834ae9&width=414.5)
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636691150552-4b5e7d55-e358-4ec1-8634-50b7cdb25916.png#clientId=ue8d82e11-d7d8-4&from=paste&height=121&id=u0b1899ff&margin=%5Bobject%20Object%5D&name=image.png&originHeight=242&originWidth=830&originalType=binary&ratio=1&size=61313&status=done&style=none&taskId=u245a4692-5610-4e1b-a1b2-c07fb163959&width=415)


## bash 数学运算之bc

- bc 是bash 内建的运算器，支持浮点数运算
- 内建变量scale可以设置，默认为0

![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636692183392-07f8ebff-e734-4929-aca8-a3326878b35b.png#clientId=ue8d82e11-d7d8-4&from=paste&height=132&id=uef0095a7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=263&originWidth=738&originalType=binary&ratio=1&size=57432&status=done&style=none&taskId=u8683b092-0339-4afd-b8f0-8d8219494f9&width=369)
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636692205344-ca318c5b-0f40-49b7-a271-baa0be1688b0.png#clientId=ue8d82e11-d7d8-4&from=paste&height=80&id=uc31d766f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=160&originWidth=734&originalType=binary&ratio=1&size=40073&status=done&style=none&taskId=uef5a0a5b-4b46-4e50-bb84-699d6b9acfe&width=367)
`echo "24/7" | bc`

# 函数的高级用法
## 函数的定义和使用

- Linux Shell 中的函数和大多数编程语言中的函数一样
- 将相似的任务或者代码封装到函数中，供其他地方调用

​

第一种格式
```shell
name()
{
	command
}
```
第二种格式
```shell
function name
{
	command
}
```

- 直接使用函数名调用，可以将其想象成shell中的一条命令
- 函数内部可以直接使用参数$1,$2$n
- 函数调用： function_name $1 $2

​

```shell
ps -ef | grep nginx | grep -v grep
```
## 向函数传递参数
```shell
function name
{
	echo "Hello $1"
}
```


## 函数的返回值


使用return返回值

- 使用return 返回值只能返回1-255的整数
- 函数使用 return 返回值，通常只是用来供其他地方调用获取状态，因此通常仅返回 0 或 1；0 表示成功，1表示失败

​

使用echo返回值

- 使用echo可以返回任何字符串结果
- 通常用于返回数据，比如一个字符串值或者列表值

​

## 全部变量和局部变量
全局变量

- 不做特殊生命，shell中变量都是全局变量
- Tips 大型脚本程序中函数慎用全局变量



局部变量

- 定义变量时，使用local 关键字
- 函数内和外若存在同名的变量，则函数内部变量覆盖外部变量

​

## 函数库
为什么要定义函数库

- 经常使用的重读代码封装成函数文件
- 一般不直接执行，而是通过其他脚本调用

​

经验之谈

- 库文件名的后缀是任意的，但一般使用.lib
- 库文件通常没有可执行的权限的
- 库文件无需和脚本在拥挤目录，秩序在脚本引用时指定
- 第一行一般使用#!/bin/echo， 输出警告信息，避免用户执行

​

# Shell 编程中的常用工具
## 文件查找 find 命令
find 命令语法格式
`find [路径] [选项] [操作]`
​

选项参数对照表
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636942345413-c7e0baf9-226b-43c6-b874-d2c42456b69e.png#clientId=u73106f89-b8f9-4&from=paste&height=174&id=u23777085&margin=%5Bobject%20Object%5D&name=image.png&originHeight=348&originWidth=944&originalType=binary&ratio=1&size=172822&status=done&style=none&taskId=u6bbc69b0-5039-4f8a-97de-85799287efe&width=472)
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636942381362-8152b5b9-d4fc-453e-add7-e304e00ce788.png#clientId=u73106f89-b8f9-4&from=paste&height=198&id=uda7c558a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=395&originWidth=945&originalType=binary&ratio=1&size=216159&status=done&style=none&taskId=u87c764b1-4d92-4bf4-918f-92797aa3317&width=472.5)


```
find命令总结：

	常用选项：
	
		-name			查找/etc目录下以conf结尾的文件	find /etc -name '*conf'
		-iname			查找当前目录下文件名为aa的文件，不区分大小写	find . -iname aa
		-user			查找文件属主为hdfs的所有文件	find . -user hdfs
		-group			查找文件属组为yarn的所有文件	find . -group yarn		
		-type			
		
			f		文件				find . -type f 
			d		目录				find . -type d
			c		字符设备文件		find . -type c
			b		块设备文件			find . -type b
			l		链接文件			find . -type l
			p		管道文件			find . -type p
			
		
		-size
		
			-n		小于大小n的文件
			+n		大于小于n的文件
			
			例子1：查找/etc目录下小于10000字节的文件		find /etc -size -10000c
			例子2：查找/etc目录下大于1M的文件				find /etc -size +1M
		
		-mtime		
		
			-n		n天以内修改的文件
			+n		n天以外修改的文件
			n		正好n天修改的文件
			
			例子1：查找/etc目录下5天之内修改且以conf结尾的文件	find /etc -mtime -5 -name '*.conf'
			例子2：查找/etc目录下10天之前修改且属主为root的文件	find /etc -mtime +10 -user root
			
		-mmin
			
			-n		n分钟以内修改的文件
			+n		n分钟以外修改的文件
			
			例子1：查找/etc目录下30分钟之前修改的文件		find /etc -mmin +30
			例子2：查找/etc目录下30分钟之内修改的目录		find /etc -mmin -30 -type d
		
		-mindepth n		表示从n级子目录开始搜索
		
			例子：在/etc下的3级子目录开始搜索		find /etc -mindepth 3 
		
		-maxdepth n		表示最多搜索到n级子目录
		
			例子1：在/etc下搜索符合条件的文件，但最多搜索到2级子目录		find /etc -maxdepth 3 -name '*.conf'
			例子2：
				find ./etc/ -type f -name '*.conf' -size +10k -maxdepth 2
		
			
		
		
	了解选项：
	
		-nouser		查找没有属主的用户
		
			例子：find . -type f -nouser
		
		-nogroup	查找没有属组的用户
		
			例子：find . -type f -nogroup
		
		-perm
		
			例子：find . -perm 664
		
		-prune
		
			通常和-path一起使用，用于将特定目录排除在搜索条件之外
			例子1：查找当前目录下所有普通文件，但排除test目录
				find . -path ./etc -prune -o -type f
			例子2：查找当前目录下所有普通文件，但排除etc和opt目录
				find . -path ./etc -prune -o -path ./opt -prune -o -type f
			例子3：查找当前目录下所有普通文件，但排除etc和opt目录，但属主为hdfs
				find . -path ./etc -prune -o -path ./opt -prune -o -type f -a -user hdfs
			例子4：查找当前目录下所有普通文件，但排除etc和opt目录，但属主为hdfs，且文件大小必须大于500字节
				find . -path ./etc -prune -o -path ./opt -prune -o -type f -a -user hdfs -a -size +500c
		
		-newer file1
		
			例子：find /etc -newer a
			
	操作：
	
	
		-print		打印输出
		
		-exec		对搜索到的文件执行特定的操作，格式为-exec 'command' {} \;
		
			例子1：搜索/etc下的文件(非目录)，文件名以conf结尾，且大于10k，然后将其删除
			
				find ./etc/ -type f -name '*.conf' -size +10k -exec rm -f {} \;
				
			例子2：将/var/log/目录下以log结尾的文件，且更改时间在7天以上的删除
			
				find /var/log/ -name '*.log' -mtime +7 -exec rm -rf {} \;
				
			例子3：搜索条件和例子1一样，只是不删除，而是将其复制到/root/conf目录下
			
				find ./etc/ -size +10k -type f -name '*.conf' -exec cp {} /root/conf/ \;
				
		-ok			和exec功能一样，只是每次操作都会给用户提示
		
	逻辑运算符：
	
		-a			与
		-o			或
		-not|!		非
		
		例子1：查找当前目录下，属主不是hdfs的所有文件		
		
			find . -not -user hdfs 	|	find . ! -user hdfs
		
		例子2：查找当前目录下，属主属于hdfs，且大小大于300字节的文件
		
			find . -type f -a -user hdfs -a -size +300c
			
		例子3：查找当前目录下的属主为hdfs或者以xml结尾的普通文件
			
			find . -type f -a \( -user hdfs -o -name '*.xml' \)
				
```
## 
## 常用的查找命令
find、locate、whereis 和 which 总结及使用场景分析
​

locate 命令介绍

- 文件查找命令，所属软件包mlocate
- 不同于find命令是在整块磁盘中搜索，locate命令是在数据库文件中查找
- find 是默认全部匹配，locate 则是默认部分匹配

​

updatedb命令

- 用户更新/var/lib/mlocate/mlocate.db
- 所使用配置文件/etc/updatedb.conf
- 改命令在后台cron计划中定期执行

​

whereis 命令

- 作用：查找某个命令的二进制程序文件、帮助文档、源代码文件

![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636956404960-9be0b092-0623-4d4e-97fd-b342412952da.png#clientId=u73106f89-b8f9-4&from=paste&height=100&id=u9091ad1b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=200&originWidth=807&originalType=binary&ratio=1&size=80105&status=done&style=none&taskId=uc6d03128-0ad5-4b6a-8b08-56743925fa8&width=403.5)


which 命令

- 作用：今查找二进制文件

![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636956506382-65e10817-661b-4d95-87e0-db8ed2865784.png#clientId=u73106f89-b8f9-4&from=paste&height=54&id=ue7c60b84&margin=%5Bobject%20Object%5D&name=image.png&originHeight=108&originWidth=803&originalType=binary&ratio=1&size=36339&status=done&style=none&taskId=u5cc04fb8-964b-4fe3-81bb-9a2390f4c03&width=401.5)


各个命令使用场景的推荐

| 命令 | 适用场景 | 优缺点 |
| --- | --- | --- |
| find | 查找某一类文件，比如文件名部分一致 | 功能强大，速度慢 |
| locate | 只能查找单个文件 | 功能单一，速度快 |
| whereis | 查找程序的可执行文件、帮助文档 | 不常用 |
| which | 只查找程序的可执行文件 | 常用语查找程序的绝对路径 |



# grep 和 egrep

1. grep [option] [pattern] [file1,file2...]
1. command | grep [option] [pattern]

![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636957445402-9d34c99b-48c3-40f6-872a-d74f7d56f7b1.png#clientId=u73106f89-b8f9-4&from=paste&height=172&id=uc8805f22&margin=%5Bobject%20Object%5D&name=image.png&originHeight=344&originWidth=956&originalType=binary&ratio=1&size=221190&status=done&style=none&taskId=u59a78c5a-3349-4269-9a3b-a8ce302c706&width=478)


不常用
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1636957586381-14ede0d9-e2fd-4421-86ba-c34763673ffc.png#clientId=u73106f89-b8f9-4&from=paste&height=151&id=ub9451597&margin=%5Bobject%20Object%5D&name=image.png&originHeight=302&originWidth=961&originalType=binary&ratio=1&size=103322&status=done&style=none&taskId=u11726e86-da84-4a28-ac87-db89ee28de7&width=480.5)


# sed
sed （stream editor），流编辑器。对标准输出或文件逐行进行处理
​

语法格式

- `stdout | sed [option] "pattern command"`
- `sed [option] "pattern command" file`



sed 选项
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1637025801323-721e7326-f99e-44e2-80c6-6f878ae1907f.png#clientId=u73106f89-b8f9-4&from=paste&height=130&id=u2404f7da&margin=%5Bobject%20Object%5D&name=image.png&originHeight=259&originWidth=696&originalType=binary&ratio=1&size=101765&status=done&style=none&taskId=u1b41c5c6-c5fc-4b57-a29d-1b74fcbbcc0&width=348)


## sed 中 pattern 详解
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1637026344463-843f2915-04ab-42f7-8051-c0a9ce14fd6b.png#clientId=u73106f89-b8f9-4&from=paste&height=170&id=ubcc5c979&margin=%5Bobject%20Object%5D&name=image.png&originHeight=340&originWidth=1012&originalType=binary&ratio=1&size=221724&status=done&style=none&taskId=u362083ca-4ffe-4fe4-a3fc-2084cf55b14&width=506)


## sed 中的编辑命令详解



| 类别 | 编辑命令 | 含义 |
| --- | --- | --- |
| 查询 | p | 打印 |
| 新增 | a | 行后追加 |
|  | i | 行前追加 |
|  | r | 外部文件读入，行后追加 |
|  | w | 匹配行写入外部文件 |
| 删除 | d | 删除 |
| 修改 | s/old/new | 将行内第一个old换成new |
|  | s/old/new/g | 将行内全部old更换为new |
|  | s/old/new/2 | 将行内前两个old更换成new |
|  | s/old/new/ig | 将行内的old全部更换为new，忽略大小写 |

`&` 和 `\1` 都可以代表反向引用，`\1`需要将前面匹配到的区域用括号括起来
​

## 利用 sed 删除特定的内容
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1637058419878-577eb9e9-ecbd-48a2-b2fe-223c9e58108d.png#clientId=ud25c0f60-52e8-4&from=paste&height=201&id=u0fc90ef1&margin=%5Bobject%20Object%5D&name=image.png&originHeight=402&originWidth=1154&originalType=binary&ratio=1&size=257179&status=done&style=none&taskId=u1cc08023-9a75-4fe7-87a0-a954efec60a&width=577)
## 利用 sed 修改文件内容
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1637059190437-df457dd0-a33a-4d77-aa4c-009b570707bf.png#clientId=ud25c0f60-52e8-4&from=paste&height=249&id=uf11f722a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=498&originWidth=1147&originalType=binary&ratio=1&size=345903&status=done&style=none&taskId=u7c87b5b3-c1de-4024-8d22-bd62417dc4c&width=573.5)


# awk
简介：awk 是一个文本处理工具，通常用于处理数据并生成结果报告


awk 的工作模式
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1637145727231-62a42144-d0c7-41f6-9614-964bcae7ff4c.png#clientId=u4c663610-8bbf-4&from=paste&height=155&id=udfd90d0f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=310&originWidth=590&originalType=binary&ratio=1&size=13870&status=done&style=none&taskId=u94008b7f-3b59-4784-8553-91d1316f536&width=295)


语法格式：

- `awk 'BEGIN{}parrern{commands}END{}' file_name`
- `standard output | awk 'BEGIN{}parttern{commands}END{}'`

​

![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1637145858333-202bc1dd-a76f-4393-b5b6-a8749d8e7704.png#clientId=u4c663610-8bbf-4&from=paste&height=108&id=u0aae8c3f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=215&originWidth=706&originalType=binary&ratio=1&size=86306&status=done&style=none&taskId=ua07886d3-ab90-415a-a538-d8546b86329&width=353)


## awk 的内置变量
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1637145930576-0124c06b-2e0a-4f94-8d5b-349542251215.png#clientId=u4c663610-8bbf-4&from=paste&height=198&id=uaa839871&margin=%5Bobject%20Object%5D&name=image.png&originHeight=395&originWidth=922&originalType=binary&ratio=1&size=190445&status=done&style=none&taskId=uacbacd57-704e-4d9a-9aea-2cc6e89e01f&width=461)
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1637146038153-67981c3c-4095-4ee5-bd5d-64ec9d3f19bb.png#clientId=u4c663610-8bbf-4&from=paste&height=83&id=u03513aa6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=166&originWidth=928&originalType=binary&ratio=1&size=67693&status=done&style=none&taskId=ub039bb32-f7e4-49b6-832b-e6c290d7e03&width=464)


## awk 的格式化输出
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1637211909195-a2ad0d2f-2e4a-4545-a56a-cd73e4efb406.png#clientId=u4c663610-8bbf-4&from=paste&height=156&id=u4adf8894&margin=%5Bobject%20Object%5D&name=image.png&originHeight=312&originWidth=904&originalType=binary&ratio=1&size=95876&status=done&style=none&taskId=u263537e9-551e-4850-838c-df94f6fe995&width=452)
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1637211941092-1debf1c9-a3eb-4a34-bd56-648cc1b7c96e.png#clientId=u4c663610-8bbf-4&from=paste&height=82&id=u31789b5a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=164&originWidth=906&originalType=binary&ratio=1&size=49159&status=done&style=none&taskId=u314237f1-ee72-4a89-b064-ffe3943a0c8&width=453)


## awk 模式匹配的两种用法

- RegExp
- 关系运算符匹配

![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1638408785226-dc626fff-11b6-4028-9b16-233b67447901.png#clientId=u149d0ccb-6fd2-4&from=paste&height=105&id=uabd7f5f2&margin=%5Bobject%20Object%5D&name=image.png&originHeight=166&originWidth=320&originalType=binary&ratio=1&size=28635&status=done&style=none&taskId=uca0b2161-2664-410f-b009-8ae061d3f2f&width=202)
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1638409097977-b5f95b25-c3a7-41cb-a44e-566e3be69677.png#clientId=u149d0ccb-6fd2-4&from=paste&height=100&id=u3cfd0e5a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=94&originWidth=221&originalType=binary&ratio=1&size=8792&status=done&style=none&taskId=u29674131-2b70-4e8e-9ae1-639351bdc18&width=235.5)


## awk 动作表达式中的算数运算符
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1638409313595-1ea5afa0-e892-4704-ad5a-4da20d600c27.png#clientId=u149d0ccb-6fd2-4&from=paste&height=160&id=u891a438c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=320&originWidth=587&originalType=binary&ratio=1&size=55333&status=done&style=none&taskId=u2a883b93-9517-4b1d-bcf6-e7adb6ed9d0&width=293.5)


## awk 中条件语句
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1638755639224-97154272-f463-4f08-9743-979e370de80e.png#clientId=u9951a73e-6ace-4&from=paste&height=112&id=ub4b7e5bd&margin=%5Bobject%20Object%5D&name=image.png&originHeight=224&originWidth=320&originalType=binary&ratio=1&size=12009&status=done&style=stroke&taskId=udd23328d-0131-4f12-ac63-550bc6a80e4&width=160)
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1638756216705-d2ae8963-4e15-42e8-84d9-21a7205b8d1b.png#clientId=u9951a73e-6ace-4&from=paste&height=45&id=uf85c70a1&margin=%5Bobject%20Object%5D&name=image.png&originHeight=89&originWidth=450&originalType=binary&ratio=1&size=9300&status=done&style=stroke&taskId=u5c9d22c4-b092-4827-a273-66670b69116&width=225)


## awk 中的字符串函数
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1638768913848-3859ef22-cb5c-43d2-84bb-a713a18e208b.png#clientId=u9951a73e-6ace-4&from=paste&height=177&id=u1b7f1e09&margin=%5Bobject%20Object%5D&name=image.png&originHeight=330&originWidth=913&originalType=binary&ratio=1&size=247485&status=done&style=none&taskId=ua277443a-21b3-4a99-9f36-93ee2457e57&width=488.5)
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1638851698125-ba9b314a-9bb5-49ee-88bf-50141a6ece8e.png#clientId=u2677a48c-0177-4&from=paste&height=112&id=ub4d71f25&margin=%5Bobject%20Object%5D&name=image.png&originHeight=224&originWidth=973&originalType=binary&ratio=1&size=225502&status=done&style=none&taskId=uc35fbe7f-a91c-465a-bf5f-d611144b1eb&width=486.5)


## awk 选项总结


![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1638851762773-1529ca03-7077-4375-b479-030ae0b9997f.png#clientId=u2677a48c-0177-4&from=paste&height=125&id=u03c8ffa3&margin=%5Bobject%20Object%5D&name=image.png&originHeight=250&originWidth=974&originalType=binary&ratio=1&size=66369&status=done&style=none&taskId=udd7876d5-a35e-42ef-a83a-1dbe73072a7&width=487)


## awk 中数组中的用法
shell中数组的用法
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1638855668335-e37677a6-d0be-4ea8-a2e4-629d3def7b52.png#clientId=u2677a48c-0177-4&from=paste&height=156&id=u6fadbf93&margin=%5Bobject%20Object%5D&name=image.png&originHeight=311&originWidth=949&originalType=binary&ratio=1&size=143300&status=done&style=none&taskId=u584fe313-d6b4-424e-afdf-b2b33df909b&width=474.5)
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1013391/1638856373490-fce58be8-d2a5-4103-8765-e880ceb6a65a.png#clientId=u2677a48c-0177-4&from=paste&height=201&id=u3b22d927&margin=%5Bobject%20Object%5D&name=image.png&originHeight=402&originWidth=1000&originalType=binary&ratio=1&size=196111&status=done&style=none&taskId=u83e9389b-5b73-4061-b91a-6f31b592cce&width=500)




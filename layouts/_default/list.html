{{- define "main" }}

    {{- if (and site.Params.profileMode.enabled .IsHome) }}
        {{- partial "index_profile.html" . }}
    {{- else }} {{/* if not profileMode */}}

    {{- if not .IsHome | and .Title }}
        <header class="page-header">
            {{- partial "breadcrumbs.html" . }}
            <h1>
                {{ .Title }}
                {{- if and (or (eq .Kind `term`) (eq .Kind `section`)) (.Param "ShowRssButtonInSectionTermList") }}
                    <a href="index.xml" title="RSS" aria-label="RSS">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                             stroke-width="2"
                             stroke-linecap="round" stroke-linejoin="round" height="23">
                            <path d="M4 11a9 9 0 0 1 9 9"/>
                            <path d="M4 4a16 16 0 0 1 16 16"/>
                            <circle cx="5" cy="19" r="1"/>
                        </svg>
                    </a>
                {{- end }}
            </h1>
            {{- if .Description }}
                <div class="post-description">
                    {{ .Description | markdownify }}
                </div>
            {{- end }}
        </header>
    {{- end }}

    {{- if .Content }}
        <div class="post-content">
            {{- if not (.Param "disableAnchoredHeadings") }}
                {{- partial "anchored_headings.html" .Content -}}
            {{- else }}{{ .Content }}{{ end }}
        </div>
    {{- end }}

    {{- $pages := union .RegularPages .Sections }}

    {{- if .IsHome }}
        {{- $pages = where site.RegularPages "Type" "in" site.Params.mainSections }}
    {{- end }}

    {{- $paginator := .Paginate $pages }}

    {{- if and .IsHome site.Params.homeInfoParams (eq $paginator.PageNumber 1) }}
        {{- partial "home_info.html" . }}
    {{- end }}

    {{- $term := .Data.Term }}
    {{- range $index, $page := $paginator.Pages }}

        {{- $class := "post-entry" }}

        {{- $user_preferred := or site.Params.disableSpecial1stPost site.Params.homeInfoParams }}
        {{- if (and $.IsHome (eq $paginator.PageNumber 1) (eq $index 0) (not $user_preferred)) }}
            {{- $class = "first-entry" }}
        {{- else if $term }}
            {{- $class = "post-entry tag-entry" }}
        {{- end }}

        <article class="{{ $class }}">
            {{- $isHidden := (site.Params.cover.hidden | default site.Params.cover.hiddenInList) }}
            {{- partial "cover.html" (dict "cxt" . "IsHome" true "isHidden" $isHidden) }}
            <header class="entry-header">
                <h2>
                    {{- .Title }}
                    {{- if .Draft }}<sup><span class="entry-isdraft">&nbsp;&nbsp;[draft]</span></sup>{{- end }}
                </h2>
            </header>
            {{- if (ne (.Param "hideSummary") true) }}
                <div class="entry-content">
                    <p>{{ .Summary | plainify | htmlUnescape }}{{ if .Truncated }}...{{ end }}</p>
                </div>
            {{- end }}
            {{- if not (.Param "hideMeta") }}
                <footer class="entry-footer">
                    {{- partial "post_meta.html" . -}}
                </footer>
            {{- end }}
            <a class="entry-link" aria-label="post link to {{ .Title | plainify }}" href="{{ .Permalink }}"></a>
        </article>
    {{- end }}

    {{- if gt $paginator.TotalPages 1 }}
        <div class="px-4 py-3 flex items-center justify-between sm:px-6">
            <div class="flex-1 flex justify-between sm:hidden">
                {{- if $paginator.HasPrev }}
                    <a href="{{ $paginator.Prev.URL | absURL }}"
                       class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                        {{ i18n "prev_page" }}
                    </a>
                {{- else }}
                    {{/* todo: 这里需要修改 */}}
                    <div></div>
                {{- end }}
                {{- if $paginator.HasNext }}
                    <a href="{{ $paginator.Next.URL | absURL }}"
                       class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                        {{ i18n "next_page" }}
                    </a>
                {{- else }}
                    {{/* todo: 这里需要修改 */}}
                    <div></div>
                {{- end }}
            </div>
            <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                <div>
                    <p class="text-sm text-gray-700 dark:text-white">
                        Showing
                        <span class="font-medium">{{$paginator.PageNumber}}</span>
                        to
                        <span class="font-medium">{{$paginator.TotalPages}}</span>
                        of
                        <span class="font-medium">{{$paginator.TotalNumberOfElements}}</span>
                        results
                    </p>
                </div>
                <div>
                    <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                        {{- if $paginator.HasPrev }}
                            <a href="{{ $paginator.Prev.URL | absURL }}"
                               class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                <span class="sr-only">Previous</span>
                                <!-- Heroicon name: solid/chevron-left -->
                                <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                     fill="currentColor" aria-hidden="true">
                                    <path fill-rule="evenodd"
                                          d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"
                                          clip-rule="evenodd"/>
                                </svg>
                            </a>
                        {{- end }}
                        <!-- Current: "z-10 bg-indigo-50 border-indigo-500 text-indigo-600", Default: "bg-white border-gray-300 text-gray-500 hover:bg-gray-50" -->
                        {{- range $index, $pager := $paginator.Pagers }}
                            {{- if eq $paginator.PageNumber $pager.PageNumber}}
                                <a href="{{ $pager.URL | absURL }}" aria-current="page"
                                   class="z-10 bg-indigo-50 border-indigo-500 text-indigo-600 relative inline-flex items-center px-4 py-2 border text-sm font-medium">
                                    {{ $pager.PageNumber }}
                                </a>
                            {{- else }}
                                <a href="{{ $pager.URL | absURL }}"
                                   class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center px-4 py-2 border text-sm font-medium">
                                    {{ $pager.PageNumber }}
                                </a>
                            {{- end }}
                        {{- end}}
                        {{- if $paginator.HasNext }}
                            <a href="{{ $paginator.Next.URL | absURL }}"
                               class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                <span class="sr-only">Next</span>
                                <!-- Heroicon name: solid/chevron-right -->
                                <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                     fill="currentColor" aria-hidden="true">
                                    <path fill-rule="evenodd"
                                          d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                          clip-rule="evenodd"
                                    />
                                </svg>
                            </a>
                        {{- end }}
                    </nav>
                </div>
            </div>
        </div>
    {{- end }}

    {{- end }}{{/* end profileMode */}}

{{- end }}{{- /* end main */ -}}
